# 学生网格化管理平台（第二组项目_v2.0）

本地与云开发的跳转链接统一使用相对路径格式：使用./ 或者 ../ 进行跳转

## PR要求

1. 流程：add --> commit --> 拉取最新小组 repo 到个人 fork repo --> pull --> push --> 提交PR
2. 每人只 add 自己负责部分的代码文件，不要 add 整个项目文件夹，便于审核
3. 将前端页面效果截图，放在introduction文件夹下的对应文件夹中
4. PR 用中文填写：在 xxx 文件中更新了 xxx 功能，不符合要求的 pull - request 会被打回

## 数据库

### 用户身份表 rbac role

- 新增了学生管理员（4），目前的身份有：超级管理员（1）、教师管理员（2）、学生（3）、学生管理员（4）
- 学工老师为超级管理员（1），苑指导老师为教师管理员（2），班长支书班委等为学生管理员（4），其余学生为学生（3）
- 批量数据导入时，教师为教师管理员（2），所有学生均为学生（3），后续教师可以在学苑管理/学生名单页面搜索特定学生，将某身份修改为学生管理员，
- 由于联络员均为苑委，因此不再增加学生联络员这一身份
- 由于增加了学生的身份种类，查找所有学生需要修改条件（role_id==3 or role_id==4）

### 学生信息表 user info

 - 修改了学生信息表user_info，将联系方式、邮箱 / 导师、导师联系方式、紧急联系人、紧急联系人电话、居住地址字段删除（迁移到联络表contact）
 - 当前有的字段：学生id、学号、姓名、拼音、性别、院系、学苑、疫苗接种计量、最后一次核酸日期、出生日期、del
 - 删除了role_id字段，用户身份需要到rbac_user_has_role表中查询

### 联络表 user_contact

- 字段：id编号，用户id，联络员pid，联系方式、邮箱 / 导师、导师联系方式、紧急联系人、紧急联系人电话、居住地址
- 在批量导入时，插入一条空数据（只含有id和用户id）进入数据库中
- 教师的导师、导师联系方式、紧急联系人、紧急联系人联系方式、居住地址均为空
- 后续用户的个人联络信息在更新个人联系方式页面进行更新

### 学苑管理表 user_manage_department

- 字段：id、user_id、管理的学苑id、del
- 记录苑指导老师为哪个苑的指导老师，一个老师可以管理多个学苑
- 记录学生管理员为哪个苑的学生管理员，学生管理员只能是自己苑的管理员

### 登录表 rbac user

- 增加了字段modify，用于判断用户是否修改了初始密码
- 删除了del字段，只在user info中保留del字段
- 由于用户名为学号/工号，因此删除了username字段

### 日志表 log

- 重新设计了log表，增加了日志的操作类型：登录、导入、导出、查询、修改、删除、搜索
- 删除了old字段，新增了操作类型字段、操作字段名字段、删除了被操作对象的档案状态字段

### 权限

- 修改了rbac menu、permission、role has permission表，修改了4个用户身份对应的页面权限
- 分离了教师个人信息页面、学生个人信息页面
- 分离了教师更新联系方式页面、学生更新联系方式页面

### 学苑表 department

- 增加了每个学苑的年级，例如2021级求知一苑


## 系统结构目录

<img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h3ghnft8ffj216e0rwjy9.jpg" alt="截屏2022-06-22 03.44.10" style="zoom:50%;" />


## 需求功能 - 任务分工

- [ ] 0. 王淳：数据库表v2.0设计、登录功能检查初始密码、用户权限配置、修改layout
- [ ] 1. 赵泽锋：各个页面调用日志记录的接口、数据库表v1.0中日志表设计
- [ ] 2. 卢赞：各个页面调用表单检查的接口、数据库表v1.0中核酸表设计
- [ ] 3. 刘潇阳：学苑苑委名单页面功能
- [ ] 4. 张娇：表单检查功能
- [ ] 5. 吴家荣：Excel批量导入功能
- [ ] 6. 黄瑞璇：模糊查询与高级查询功能（管理系统用户页面、本苑学生名单页面）
- [ ] 7. 胡文棋：学苑联络名单功能
- [ ] 8. 朱慧君：超级管理员修改学生信息功能（管理系统用户页面、本苑学生名单页面）
- [ ] 9. 李子涵：超级管理员二次删除弹窗功能
- [ ] 10. 贾瑷嘉：查询学生个人信息功能、查询教师个人信息功能
- [ ] 11. 刘媛媛：日志记录功能
- [ ] 12. 石佳玉：学生更新核酸疫苗功能
- [ ] 13. 王添翼：教师导出Excel功能
- [ ] 14. 刘荔婧：学生更新联系方式功能
- [ ] 15. 张一琛：学生更新当前状态功能
- [ ] 16. 李昭辉：用户修改密码功能
- [ ] 17. 赖雨宣：查询日志功能、首页显示用户最近日志功能
- [ ] 18. 王淳、李楠：管理学苑权限页面功能

## 功能详细描述

注：表单检查功能、日志记录功能是单独的任务，有专门的同学负责功能实现

### （赖雨宣）首页 main

- 有表单，显示当前用户最近10条日志记录

### 系统管理 （超级管理员权限）- manage

#### （吴家荣）批量导入用户 - manage.systemimport

- Excel 批量导入功能
- 提供一个模板可供下载
- 要求规定一些必填字段，当必填字段为空时，导入失败，并提示哪一行数据失败
- 前端要提示管理员，如果出现失败，例如第十行数据出错，那么在第二次导入时要删去前九行数据
- 插入4个表单：rbac_user、user_info、user_contact、rbac_user_has_role
- 表单检查功能，插入数据库前验证数据是否符合要求
- 日志记录功能，记录导入了多少条数据，数据的id是什么范围

#### （黄瑞璇）管理系统用户 - manage.systemuser

- 管理系统中所有用户：超级管理员、教师、学生、学生管理员
- 有模糊查询功能、高级查询功能、刚进去的页面不需要有用户名单，只需要有查询组件即可
- 有放大镜功能、修改功能、删除功能
- 可以查询个人联系信息未更新的学生名单（不查教师），任何一个字段未更新都算）（查不到，或者信息不全）
- 可以查询一个苑的管理员都有谁
- 可以查询某天未做核酸的用户名单
- 其他查询功能同前
- 修改功能中有表单检查功能，修改的数据在插入数据库前验证数据是否符合要求
- 删除功能要同时在三个表（userinfo、usercontact、rbacuser）中，将del字段设置为1
- 有日志记录功能，记录用户查询了什么字段信息，查看了哪个用户的详细信息，修改了哪个用户的哪个字段，删除了哪个用户
- 有名单导出功能

#### （王淳、李楠）管理学苑权限 - manage.systempermission

- 超级管理员可以在这个页面修改教师管理员为某一个学苑的指导教师
- 对应的数据库为 user_manage_department
- 从而实现一个教师可以管理多个学苑的功能
- 在这个页面有一个搜索组件，和表单，提供模糊搜索，在全体教师（role_id=2且del=0）中搜索教师
- 表单中显示教师的工号、姓名、管理的学苑名称
- 超级管理员可以选择某个教师，并在下拉菜单中选择某一个学苑
- 可以新增某教师为某学苑管理员，可以新增多条，可以修改某一条，也可以删除（del修改为1）
- 允许搜索学生，允许设置学生管理某个苑，教师也可以在supervise/checkstudent中将学生的身份修改为学生管理员
- 有日志记录功能，记录用户增加了一个学苑管理权限
- 有表单检查功能，检查数据库中增加的数据是否符合要求

#### （赖雨宣）查询系统日志 - manage.systemlog

- 查询系统日志功能
- 前端只有一个查询组件，参考 manage/Systemuser/index.html
- 有模糊搜索功能、高级搜索功能，参考 manage/Systemuser.php，需要针对日志表进行调整
- 可以搜索某个学生的操作，可以搜索他的学号、姓名、拼音等，这些都可以搜
- 日志表中存储了每次操作人和被操作人的id，如果用户更新自己的信息，则这两个id都是自己
- 如果超级管理员或者管理员修改了别的用户的信息，则这两个id分别是管理员和操作对象
- 有放大镜功能，可以在查询结果的表单中显示几个关键字段，其余信息放到放大镜中，点击放大镜跳转该条日志的详细信息
- 比如在查询表单中显示编号、操作人姓名、被操作人姓名、操作时间、操作类型，把操作的字段和更新的信息放到放大镜中
- 无名单导出功能
- 有日志记录功能，记录了用户在何时查询了什么信息的日志，查看了哪条日志的详细信息

### 学苑管理 supervise

#### （黄瑞璇）学生名单页面 （教师管理员、学生管理员权限）- supervise.checkstudent

- 学苑名单页面中有查询组件和本苑学生管理员名单，教师可以管理哪个苑，从user_manage_department表中查询，取出教师管理的所有苑中学生的信息
- 可以搜索所有本苑的学生（包括学生和学生管理员）（模糊搜索、高级搜索）
- 对学生有放大镜功能、修改功能、无删除功能
- 在放大镜功能中，包含该学生的基本信息与联系信息，自己的联络人姓名，联络人的联系方式、邮箱
- 可以将某个学生的role修改为学生管理员（role_id = 4）（下拉菜单中只有学生和学生管理员两个选项）
- 可以修改学生的姓名拼音（学生自己无法修改），以及其他信息
- 可以将某个学生的联络负责人修改为本学苑的一位学生管理员（下拉列表里有本苑所有role_id=4的学生管理员姓名）
- 修改功能中有表单检查功能，检查数据库中增加的数据是否符合要求
- 有名单导出功能
- 有日志记录功能
  - 记录本人查看了联络名单页面
  - 记录本人查看了哪个学生的个人信息
  - 记录修改了哪个学生的哪个字段，修改了后的信息是什么
  - 记录用户搜索了什么信息
  - 记录是否导出了学生名单


#### （刘潇阳）苑委名单页面（教师管理员、学生管理员权限）- supervise.checksupervisor

- 院系名单页面中无查询组件，有表单，显示本苑中所有管理员（role_id = 2 or 4）名单，编号、姓名、学号、学苑、当前状态
- 有放大镜功能、无修改功能、无删除功能（这里的放大镜显示该苑委的个人基本信息，同时给出其负责联络的学生的学号和姓名，联系方式）
- 无名单导出功能
- 无表单检查功能
- 有日志记录功能，记录本人查看了联络名单页面，记录本人查看了哪个学生的个人信息

#### （胡文棋）联络名单页面（学生管理员权限）- supervise.checkcontact

- 联络名单页面中无查询组件，有表单，显示苑委自己负责联络的学生（role_id=3）名单
- 无搜索功能、无导出功能
- 对学生有放大镜功能、无修改功能、无删除功能
- 无导出功能
- 无表单检查功能
- 有日志记录功能，记录本人查看了联络名单页面，记录本人查看了哪个学生的个人信息

### 个人信息 personal

#### （贾瑷嘉）学生个人信息（学生、学生管理员权限）- personal.studentinfo

- 从两个表里取数据，user_info取出基本信息，user_contact取出联系信息
- 在联系信息中，包含自己的信息，自己的联络人姓名，联络人的联系方式、邮箱
- 有日志记录功能，记录本人查看了自己的个人信息
- 无表单检查功能

#### （贾瑷嘉）教师个人信息（超级管理员、教师管理员权限）- personal.teacherinfo

- 从两个表里取数据，user_info取出基本信息，user_contact取出联系信息
- 教师的导师、导师联系方式、紧急联系人、紧急联系人联系方式、居住地址均为空，前端表单不显示这些字段
- 有日志记录功能，记录本人查看了自己的个人信息
- 无表单检查功能

#### （刘荔婧）更新个人联系信息

- 学生可以更新自己的联系方式、邮箱 、紧急联系人、紧急联系人电话、居住地址
- 教师可以更新自己的联系方式、邮箱
- 页面显示个人的所有信息，实现单个字段修改，例如只修改手机号
- 如果用户提交的所有字段均和数据库中的原始数据相同，提示用户您的联系信息未发生变化
- 修改成功后，提示用户修改了哪些字段
- 有日志记录功能，记录本人更新了哪些字段的信息
- 有表单检查功能，检查数据库中增加的数据是否符合要求

#### （张一琛）更新个人当前状态

- 有日志记录功能，记录本人更新了个人状态
- 有表单检查功能，检查数据库中增加的数据是否符合要求

#### （石佳玉）更新个人核酸疫苗状态

- 修改前端表单样式
- 删除疫苗不能重复提交的逻辑，可以在选择第二针之后，再更新自己的疫苗为第一针
- 增加核酸谎报提醒
- 有日志记录功能，记录本人更新了哪个字段
- 有表单检查功能，检查数据库中增加的数据是否符合要求

### （李昭辉）修改密码

- 修改验证登录密码为初始密码的逻辑，检查是否已经修改密码
- 修改密码后，是否修改密码字段变成1
- 有日志记录功能，记录本人修改成功后的密码（加盐后）是什么
- 有表单检查功能，检查数据库中增加的数据是否符合要求

### （王淳）登录

- Rbac user表中删除了username、del字段，相应修改登录查找用户的逻辑、连接user info表进行查找
- 修改 do login相关功能，修改session保存的内容
- 修改前端样式以及layout，提供四个身份的测试账号
- 提供一些实验的用户数据，建立学苑网格化、联络人等测试数据
- 有日志记录功能，记录用户什么时间登录成功，ip地址、浏览器版本、客户端版本

